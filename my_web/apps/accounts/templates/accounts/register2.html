{% load staticfiles %}
<!doctype html>
<html>
<head>
    <title>用户注册—搞机情报局</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="{% static "images/myimgs/../../../../static/images/icon/icon.jpg" %}" type="image/x-icon"/>
    <link href="{% static "accounts/css/bootstrap.min.css" %}" type="text/css" rel="stylesheet">
    <link href="{% static "accounts/css/font-awesome.min.css" %}" type="text/javascript" rel="stylesheet">
    <link href="{% static "accounts/css/bootsnav.css" %}" type="text/css" rel="stylesheet">
    <link href="{% static "accounts/css/normalize.css" %}" type="text/css" rel="stylesheet">
    <link href="{% static "accounts/css/css.css" %}" rel="stylesheet" type="text/css">
    <script src="{% static "accounts/js/jquery-1.11.0.min.js" %}" type="text/javascript"></script>
    <script src="{% static "accounts/js/jquery.step.js" %}"></script>
    <script src="{% static "accounts/js/bootstrap.min.js" %}" type="text/javascript"></script>
    <script src="{% static "accounts/js/bootsnav.js" %}" type="text/javascript"></script>
    <script src="{% static "accounts/js/jquery.js" %}" type="text/javascript"></script>
    <!--[if IE]><script src="{% static "accounts/js/html5.js" %}"></script><![endif]-->

</head>

<body class="logobg_style">
  <div id="large-header" class="large-header login-page">
  	<canvas id="demo-canvas" width="1590" height="711"></canvas>
  	<div class="Retrieve_style">
  	  <div class="Retrieve-content step-body" id="myStep">
  		<h1 class="title_name">用户注册</h1>
  		<div class="step-header"> <ul><li><p>输入电话</p></li><li><p>确认密码</p></li><li><p>成功</p></li></ul></div>
 		  <div class="step-content">
  			<div class="step-list login_padding">
  				<form  role="form" id="form_login">
                    {% csrf_token %}

				 <div class="form-group clearfix">
					<div class="input-group col-lg-8 col-md-8 col-xs-8">
						<div class="input-group-addon"><i class="icon_phone"></i></div>
{#                        <input type="text" class="form-control text_phone" name="phone" id="phone" placeholder="你的手机号" autocomplete="off">#}
                        {{ form.mobile }}
					</div>
                        <div class="col-lg-4 col-md-4 col-xs-4 fl"><input type="button" id="btn" class="btn_mfyzm" value="获取验证码" onclick="Sendpwd(this)"/></div>
				</div>

				<div class="form-group clearfix">
				 <div class="input-group">
					<div class="input-group-addon"><i class="icon_yanzhen"></i></div>
{#                    <input type="text"  class="form-control"  name="Verification" id="Verification"   placeholder="短信验证码" autocomplete="off">#}
				        {{ form.mobile_captcha }}
                 </div>
				</div>
                <label class="checkbox" style="position: relative;bottom: 15px;margin-bottom: 35px">
                    <span class="pull-right"> 已有帐号， <a href="{% url 'accounts:login' %}"> 请登录 </a></span>
                </label>
             <div class="tishi"></div>
             </form> 
            <div class="form-group">
					<button  class="btn btn-danger btn-block btn-login" id="applyBtn" >下一步</button>
				</div>
			</div>

			<div class="step-list">
				<form method="post" role="form" id="" class="login_padding">
                     {% csrf_token %}
				  <div class="form-group clearfix">
					<div class="input-group">
						<div class="input-group-addon">
							<i class="icon_password"></i>
						</div>
{#						<input type="password" class="form-control" name="password" id="password" placeholder="重置密码" autocomplete="off">#}
					    {{ form.password }}
                    </div>
				</div>
				<div class="form-group clearfix">
					<div class="input-group">
						<div class="input-group-addon">
							<i class="icon_password"></i>
						</div>
{#						<input type="password" class="form-control" name="confirmpwd" id="confirmpwd" placeholder="再次密码" autocomplete="off">#}
					    {{ form.password2 }}
                    </div>
				</div>
				 <div class="tishis"></div>
				<div class="form-group">
					<button type="submit" class="btn btn-danger btn-block btn-login" id="submitBtn">下一步</button>
                </div>
				</form>
				</div>
					<div class="step-list">
					<div class="ok_style center">
                            <h2><img src="{% static "accounts/images/ok.png" %}"></h2>
	                        <h5 class="color2 mtb20">你已成功注册会员<b id="sec">5</b>秒后跳转到首页</h5>
	                        <a href="{% url "index:index" %}" class="btn btn-danger">首页</a>
	                        <a href="{% url "accounts:register" %}" class="btn btn-primary">重新注册</a>
					</div>
				</div>
			</div>
  		</div> 			
  </div>
 </div> 	
<script src="{% static "accounts/js/TweenLite/TweenLite.min.js" %}"></script>
<script src="{% static "accounts/js/TweenLite/EasePack.min.js" %}"></script>
<script src="{% static "accounts/js/TweenLite/rAF.js" %}"></script>
<script src="{% static "accounts/js/TweenLite/demo-1.js" %}"></script>

<script>
    $("#submitBtn").click(function () {
        // some_check
        $.ajax({
            url: "{% url 'accounts:register' %}",
            type: "POST",
            dataType: "json",
            data: $("#submitBtn").serialize(),
            success: function (data) {
                if(data.status == 200 ){

                    window.location.href='{% url 'index:index' %}';
                }else{
                    msg = "新错误类型"
                    if(data.status == 400 || data.status == 401){
                        msg = data.msg
                    }else{
                        for(var i in data.msg){
                            msg = i+data.msg[i]
                            break
                        }
                    }
                     $.gritter.add({
                        // (string | mandatory) the heading of the notification
                        title: '提交结果',
                        // (string | mandatory) the text inside the notification
                        //text: 'This will fade out after a certain amount of time. Vivamus eget tincidunt velit. Cum sociis natoque penatibus et <a href="#" style="color:#ccc">magnis dis parturient</a> montes, nascetur ridiculus mus.'
                        text: msg
                    });
                 }
            },
            // 解决csrftoken
            beforeSend: function(xhr, settings) {
                xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
            }
        });
    });
</script>
</body>
</html>
